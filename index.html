<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharaohNet - ÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2196F3;
            --secondary: #1976D2;
            --dark: #0D47A1;
            --light: #E3F2FD;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --dark-bg: #121212;
            --light-bg: #F5F7FA;
            --card-dark: #1E1E1E;
            --card-light: #FFFFFF;
            --text-dark: #333;
            --text-light: #FFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--light-bg);
            color: var(--text-dark);
            min-height: 100vh;
            transition: all 0.3s;
        }

        body.dark-mode {
            background: var(--dark-bg);
            color: var(--text-light);
        }

        .container {
            max-width: 100%;
            padding: 15px;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .points-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 2px solid var(--primary);
        }

        .dark-mode .points-card {
            background: var(--card-dark);
            border-color: var(--secondary);
        }

        .points-card i {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .points-card .value {
            font-size: 48px;
            font-weight: 800;
            color: var(--dark);
            margin: 10px 0;
        }

        .dark-mode .points-card .value {
            color: var(--light);
        }

        .points-card .label {
            font-size: 16px;
            color: #666;
        }

        .dark-mode .points-card .label {
            color: #AAA;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .dark-mode .section {
            background: var(--card-dark);
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dark-mode .section-title {
            color: var(--light);
        }

        .section-title i {
            color: var(--primary);
        }

        .task-card {
            background: var(--light);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
        }

        .dark-mode .task-card {
            background: rgba(33, 150, 243, 0.1);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-title {
            font-weight: 600;
            font-size: 16px;
        }

        .task-points {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .task-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }

        .dark-mode .task-description {
            color: #AAA;
        }

        .progress-container {
            margin: 15px 0;
        }

        .progress-bar {
            height: 10px;
            background: #E0E0E0;
            border-radius: 5px;
            overflow: hidden;
        }

        .dark-mode .progress-bar {
            background: #333;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s;
            border-radius: 5px;
        }

        .task-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .task-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .task-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            background: var(--success);
        }

        .task-button.completed {
            background: var(--success);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
        }

        .dark-mode .stat-item {
            background: rgba(33, 150, 243, 0.1);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
            margin: 5px 0;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .dark-mode .stat-label {
            color: #AAA;
        }

        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .dark-mode .nav-bar {
            background: var(--card-dark);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            padding: 5px 10px;
            border-radius: 10px;
        }

        .dark-mode .nav-item {
            color: #AAA;
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(33, 150, 243, 0.1);
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .nav-item span {
            font-size: 12px;
            font-weight: 600;
        }

        .daily-gift {
            background: linear-gradient(135deg, var(--success), #388E3C);
            color: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .gift-amount {
            font-size: 36px;
            font-weight: 800;
            margin: 15px 0;
        }

        .gift-timer {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .code-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--primary);
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-size: 16px;
            text-align: center;
            margin-bottom: 10px;
            direction: ltr;
        }

        .dark-mode .code-input {
            background: rgba(255,255,255,0.1);
            color: white;
            border-color: var(--secondary);
        }

        .success-message {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
            display: none;
        }

        .error-message {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading i {
            font-size: 30px;
            color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .points-card .value {
                font-size: 36px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <div class="header">
        <h1><i class="fas fa-coins"></i> PharaohNet ÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</h1>
        <p>Ø§ÙƒÙ…Ù„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ§ÙƒØ³Ø¨ Ù†Ù‚Ø§Ø· Ø­Ù‚ÙŠÙ‚ÙŠØ©</p>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ù‚Ø§Ø· -->
    <div class="points-card">
        <i class="fas fa-wallet"></i>
        <div class="value" id="points-value">0.0</div>
        <div class="label">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø·</div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©) -->
    <div id="tasks-page" class="page">
        <div class="section">
            <div class="section-title">
                <i class="fas fa-tasks"></i>
                Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            </div>
            
            <div id="tasks-container">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>

        <!-- Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
        <div class="daily-gift">
            <div class="section-title" style="color: white; justify-content: center;">
                <i class="fas fa-gift"></i>
                Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            </div>
            <div class="gift-amount" id="daily-gift-amount">+0.15 Ù†Ù‚Ø·Ø©</div>
            <div class="gift-timer" id="daily-gift-timer">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            <button class="task-button" id="claim-gift-btn" onclick="claimDailyGift()">
                <i class="fas fa-gift"></i> Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯ÙŠØ©
            </button>
        </div>

        <!-- ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ© -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-ticket-alt"></i>
                ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ©
            </div>
            <input type="text" class="code-input" id="gift-code-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ© Ù‡Ù†Ø§">
            <button class="task-button" onclick="submitGiftCode()">
                <i class="fas fa-check"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
            </button>
            <div class="success-message" id="gift-success"></div>
            <div class="error-message" id="gift-error"></div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div id="stats-page" class="page" style="display: none;">
        <div class="section">
            <div class="section-title">
                <i class="fas fa-chart-line"></i>
                Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ
            </div>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="total-points">0.0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="tasks-completed">0</div>
                    <div class="stat-label">Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø©</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="invites-count">0</div>
                    <div class="stat-label">Ø¯Ø¹ÙˆØ§Øª Ù†Ø§Ø¬Ø­Ø©</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="purchases-count">0</div>
                    <div class="stat-label">Ù…Ø´ØªØ±ÙŠØ§Øª</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">
                <i class="fas fa-share-alt"></i>
                Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©
            </div>
            <div style="text-align: center; margin: 20px 0;">
                <div style="background: #F5F5F5; padding: 15px; border-radius: 10px; margin-bottom: 15px; word-break: break-all;">
                    <span id="invite-link">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                </div>
                <button class="task-button" onclick="copyInviteLink()" style="margin-bottom: 10px;">
                    <i class="fas fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
                </button>
                <button class="task-button" onclick="shareInviteLink()" style="background: linear-gradient(135deg, var(--success), #388E3C);">
                    <i class="fas fa-share-alt"></i> Ù…Ø´Ø§Ø±ÙƒØ©
                </button>
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div id="settings-page" class="page" style="display: none;">
        <div class="section">
            <div class="section-title">
                <i class="fas fa-cog"></i>
                Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </div>
            
            <div style="text-align: center; padding: 20px;">
                <button class="task-button" onclick="toggleTheme()" style="margin-bottom: 15px;">
                    <i class="fas fa-moon"></i> ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
                </button>
                
                <button class="task-button" onclick="refreshData()" style="margin-bottom: 15px; background: linear-gradient(135deg, var(--warning), #FF5722);">
                    <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                
                <button class="task-button" onclick="contactSupport()" style="background: linear-gradient(135deg, var(--primary), var(--secondary));">
                    <i class="fas fa-headset"></i> ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…
                </button>
            </div>
        </div>

        <div class="section">
            <div class="section-title">
                <i class="fas fa-info-circle"></i>
                Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            </div>
            <div style="text-align: center; padding: 15px;">
                <p>Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: 2.0.0</p>
                <p>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø¯ÙŠØ³Ù…Ø¨Ø± 2024</p>
                <p>Ù…Ø±ØªØ¨Ø· Ù…Ø¹: @PharaohNetChopBot</p>
            </div>
        </div>
    </div>
</div>

<!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
<div class="nav-bar">
    <div class="nav-item active" onclick="showPage('tasks')">
        <i class="fas fa-tasks"></i>
        <span>Ø§Ù„Ù…Ù‡Ø§Ù…</span>
    </div>
    <div class="nav-item" onclick="showPage('stats')">
        <i class="fas fa-chart-bar"></i>
        <span>Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙŠ</span>
    </div>
    <div class="nav-item" onclick="showPage('settings')">
        <i class="fas fa-cog"></i>
        <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
    </div>
</div>

<!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div class="loading" id="loading">
    <i class="fas fa-spinner"></i>
    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
</div>

<!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª -->
<script src='//libtl.com/sdk.js' data-zone='10301752' data-sdk='show_10301752'></script>

<script>
    // ØªÙ‡ÙŠØ¦Ø© Telegram WebApp
    let tg = Telegram.WebApp;
    tg.ready();
    tg.expand();
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    let user = tg.initDataUnsafe.user || {};
    let userId = user.id || null;
    let points = 0;
    let userData = {};
    
    // Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©
    const tasks = [
        { id: 1, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #1", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" },
        { id: 2, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #2", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" },
        { id: 3, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #3", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" },
        { id: 4, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #4", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" },
        { id: 5, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #5", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" },
        { id: 6, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #6", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" },
        { id: 7, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #7", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" },
        { id: 8, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #8", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" },
        { id: 9, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #9", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" },
        { id: 10, title: "Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† #10", points: 0.5, description: "Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©" }
    ];

    // Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§
    const giftCodes = {
        "WELCOME10": 1.0,
        "PHARAOH20": 2.0,
        "VIPCODE": 5.0
    };

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    async function initApp() {
        showLoading(true);
        
        try {
            // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (user.first_name) {
                document.querySelector('.header h1').innerHTML = 
                    `<i class="fas fa-coins"></i> Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.first_name}`;
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† localStorage
            loadUserData();
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ø§Ù…
            createTasks();
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            initDailyGift();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¨ÙˆØª (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØµÙ„Ø§Ù‹)
            await fetchUserDataFromBot();
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©:', error);
            showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
        } finally {
            showLoading(false);
        }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† localStorage
    function loadUserData() {
        const savedData = localStorage.getItem(`pharaoh_user_${userId}`);
        if (savedData) {
            userData = JSON.parse(savedData);
            points = userData.points || 0;
        } else {
            userData = {
                points: 0,
                tasks_completed: [],
                daily_gift_claimed: false,
                last_daily_gift: null,
                invites: 0,
                purchases: 0,
                used_codes: []
            };
        }
        
        updateUI();
    }

    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function saveUserData() {
        localStorage.setItem(`pharaoh_user_${userId}`, JSON.stringify(userData));
    }

    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø¨ÙˆØª
    async function fetchUserDataFromBot() {
        if (!userId) return;
        
        try {
            // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø¨ÙˆØª
            const response = await fetch(`https://api.telegram.org/bot${getBotToken()}/getUserData?user_id=${userId}`);
            if (response.ok) {
                const data = await response.json();
                if (data.points !== undefined) {
                    points = data.points;
                    userData.points = points;
                    updateUI();
                }
            }
        } catch (error) {
            console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙˆØªØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
        }
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª
    async function sendPointsToBot(action, taskPoints, taskType = 'task') {
        if (!userId) {
            showError('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
            return false;
        }
        
        try {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Telegram WebApp API Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª
            const data = {
                action: action,
                points: taskPoints,
                task_type: taskType,
                user_id: userId,
                timestamp: Date.now()
            };
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Telegram WebApp
            tg.sendData(JSON.stringify(data));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            userData.points += taskPoints;
            points = userData.points;
            
            if (action === 'add_points' && taskType === 'task') {
                if (!userData.tasks_completed) userData.tasks_completed = [];
                userData.tasks_completed.push({
                    id: Date.now(),
                    points: taskPoints,
                    timestamp: Date.now()
                });
            }
            
            saveUserData();
            updateUI();
            
            return true;
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            
            // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©: Ø§Ø³ØªØ®Ø¯Ø§Ù… fetch
            try {
                const response = await fetch('YOUR_BACKEND_URL/api/update-points', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        points: taskPoints,
                        task_type: taskType,
                        init_data: tg.initData
                    })
                });
                
                if (response.ok) {
                    userData.points += taskPoints;
                    points = userData.points;
                    saveUserData();
                    updateUI();
                    return true;
                }
            } catch (fetchError) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©:', fetchError);
            }
            
            return false;
        }
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ø§Ù…
    function createTasks() {
        const container = document.getElementById('tasks-container');
        container.innerHTML = '';
        
        tasks.forEach(task => {
            const isCompleted = userData.tasks_completed?.some(t => 
                t.id === task.id || (Date.now() - t.timestamp) < 24 * 60 * 60 * 1000
            );
            
            const taskHTML = `
                <div class="task-card">
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <div class="task-points">+${task.points}</div>
                    </div>
                    <div class="task-description">${task.description}</div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${isCompleted ? '100%' : '0%'}"></div>
                        </div>
                    </div>
                    <button class="task-button ${isCompleted ? 'completed' : ''}" 
                            onclick="startTask(${task.id})" 
                            ${isCompleted ? 'disabled' : ''}>
                        <i class="fas ${isCompleted ? 'fa-check-circle' : 'fa-play'}"></i>
                        ${isCompleted ? 'Ù…ÙƒØªÙ…Ù„' : 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ù‡Ù…Ø©'}
                    </button>
                </div>
            `;
            
            container.innerHTML += taskHTML;
        });
    }

    // Ø¨Ø¯Ø¡ Ù…Ù‡Ù…Ø©
    async function startTask(taskId) {
        const task = tasks.find(t => t.id === taskId);
        if (!task) return;
        
        showLoading(true);
        
        try {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
            if (typeof window.show_10301752 === 'function') {
                await window.show_10301752();
                
                // Ø¨Ø¹Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­
                const success = await sendPointsToBot('add_points', task.points, 'task');
                
                if (success) {
                    showSuccess(`ğŸ‰ Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${task.points} Ù†Ù‚Ø·Ø©!`);
                    createTasks(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…
                } else {
                    showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·');
                }
            } else {
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
                setTimeout(async () => {
                    const success = await sendPointsToBot('add_points', task.points, 'task');
                    
                    if (success) {
                        showSuccess(`ğŸ‰ Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${task.points} Ù†Ù‚Ø·Ø©!`);
                        createTasks();
                    } else {
                        showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·');
                    }
                }, 2000);
            }
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù‡Ù…Ø©:', error);
            showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø©');
        } finally {
            showLoading(false);
        }
    }

    // Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
    function initDailyGift() {
        const lastClaim = userData.last_daily_gift;
        const now = Date.now();
        const twentyFourHours = 24 * 60 * 60 * 1000;
        
        const claimBtn = document.getElementById('claim-gift-btn');
        const timerElement = document.getElementById('daily-gift-timer');
        
        if (lastClaim && (now - lastClaim < twentyFourHours)) {
            claimBtn.disabled = true;
            claimBtn.innerHTML = '<i class="fas fa-clock"></i> Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
            
            const timeLeft = twentyFourHours - (now - lastClaim);
            updateGiftTimer(timeLeft, timerElement);
            
            // Ø¹Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠ
            const timerInterval = setInterval(() => {
                const newTimeLeft = twentyFourHours - (Date.now() - lastClaim);
                if (newTimeLeft <= 0) {
                    clearInterval(timerInterval);
                    claimBtn.disabled = false;
                    claimBtn.innerHTML = '<i class="fas fa-gift"></i> Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯ÙŠØ©';
                    timerElement.textContent = 'Ø§Ù„Ù‡Ø¯ÙŠØ© Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†!';
                } else {
                    updateGiftTimer(newTimeLeft, timerElement);
                }
            }, 1000);
        } else {
            claimBtn.disabled = false;
            timerElement.textContent = 'Ø§Ù„Ù‡Ø¯ÙŠØ© Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†!';
        }
    }

    function updateGiftTimer(timeLeft, timerElement) {
        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        
        timerElement.textContent = `Ù…ØªØ¨Ù‚ÙŠ: ${hours}Ø³ ${minutes}Ø¯ ${seconds}Ø«`;
    }

    async function claimDailyGift() {
        showLoading(true);
        
        try {
            const giftAmount = 0.15;
            const success = await sendPointsToBot('add_points', giftAmount, 'daily_gift');
            
            if (success) {
                userData.last_daily_gift = Date.now();
                userData.daily_gift_claimed = true;
                saveUserData();
                
                showSuccess(`ğŸ Ù…Ø¨Ø±ÙˆÙƒ! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${giftAmount} Ù†Ù‚Ø·Ø© ÙƒÙ‡Ø¯ÙŠØ© ÙŠÙˆÙ…ÙŠØ©!`);
                initDailyGift();
            }
        } catch (error) {
            showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø¨Ø§Ù„Ù‡Ø¯ÙŠØ©');
        } finally {
            showLoading(false);
        }
    }

    // ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ©
    async function submitGiftCode() {
        const codeInput = document.getElementById('gift-code-input');
        const code = codeInput.value.trim().toUpperCase();
        
        if (!code) {
            showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ©');
            return;
        }
        
        if (!userData.used_codes) userData.used_codes = [];
        
        if (userData.used_codes.includes(code)) {
            showError('âš ï¸ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹!');
            return;
        }
        
        if (giftCodes[code]) {
            showLoading(true);
            
            try {
                const success = await sendPointsToBot('add_points', giftCodes[code], 'gift_code');
                
                if (success) {
                    userData.used_codes.push(code);
                    saveUserData();
                    
                    showSuccess(`ğŸ‰ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${giftCodes[code]} Ù†Ù‚Ø·Ø©!`);
                    codeInput.value = '';
                }
            } catch (error) {
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯');
            } finally {
                showLoading(false);
            }
        } else {
            showError('âŒ ÙƒÙˆØ¯ Ø§Ù„Ù‡Ø¯ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­!');
        }
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function updateUI() {
        document.getElementById('points-value').textContent = points.toFixed(1);
        document.getElementById('total-points').textContent = points.toFixed(1);
        document.getElementById('tasks-completed').textContent = userData.tasks_completed?.length || 0;
        document.getElementById('invites-count').textContent = userData.invites || 0;
        document.getElementById('purchases-count').textContent = userData.purchases || 0;
        
        // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©
        if (userId) {
            const inviteLink = `https://t.me/PharaohNetChopBot?start=${userId}`;
            document.getElementById('invite-link').textContent = inviteLink;
        }
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ†Ù‚Ù„
    function showPage(page) {
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        document.getElementById(`${page}-page`).style.display = 'block';
        
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach((item, index) => {
            if ((page === 'tasks' && index === 0) || 
                (page === 'stats' && index === 1) || 
                (page === 'settings' && index === 2)) {
                item.classList.add('active');
            }
        });
        
        if (page === 'stats') {
            updateUI();
        }
    }

    // Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©
    function copyInviteLink() {
        const link = document.getElementById('invite-link').textContent;
        navigator.clipboard.writeText(link).then(() => {
            showSuccess('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­!');
        }).catch(() => {
            showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®');
        });
    }

    // Ù…Ø´Ø§Ø±ÙƒØ© Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©
    function shareInviteLink() {
        const link = document.getElementById('invite-link').textContent;
        const text = `Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ PharaohNet ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ù…Ø¬Ø§Ù†ÙŠØ©! ğŸ\n${link}`;
        
        if (tg.shareToChat) {
            tg.shareToChat(text, (shared) => {
                if (shared) {
                    showSuccess('ØªÙ… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­!');
                    
                    // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª
                    userData.invites = (userData.invites || 0) + 1;
                    saveUserData();
                    updateUI();
                }
            });
        } else if (navigator.share) {
            navigator.share({
                title: 'PharaohNet - ÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·',
                text: text,
                url: link,
            }).then(() => {
                showSuccess('ØªÙ… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­!');
                userData.invites = (userData.invites || 0) + 1;
                saveUserData();
                updateUI();
            }).catch(() => {
                copyInviteLink();
            });
        } else {
            copyInviteLink();
        }
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function refreshData() {
        showLoading(true);
        setTimeout(() => {
            loadUserData();
            createTasks();
            initDailyGift();
            showLoading(false);
            showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        }, 1000);
    }

    // Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…
    function contactSupport() {
        tg.openLink('https://t.me/Misteerx');
    }

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    function showLoading(show) {
        document.getElementById('loading').style.display = show ? 'block' : 'none';
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
    function showSuccess(message) {
        const successElement = document.getElementById('gift-success');
        successElement.textContent = message;
        successElement.style.display = 'block';
        
        setTimeout(() => {
            successElement.style.display = 'none';
        }, 3000);
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù‡ØªØ²Ø§Ø²
        tg.HapticFeedback.impactOccurred('medium');
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
    function showError(message) {
        const errorElement = document.getElementById('gift-error');
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        
        setTimeout(() => {
            errorElement.style.display = 'none';
        }, 3000);
        
        tg.HapticFeedback.impactOccurred('heavy');
    }

    // ÙˆØ¸ÙŠÙØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ØªØ·ÙˆÙŠØ±)
    function getBotToken() {
        // âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ù„Ø§ ØªØ®Ø²Ù† Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ù†Ø§
        // ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø®Ø§Ø¯Ù… backend
        return 'BOT_TOKEN_PLACEHOLDER';
    }

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¨ÙˆØª
    tg.onEvent('webAppDataReceived', (event) => {
        try {
            const data = JSON.parse(event.data);
            if (data.action === 'update_points') {
                points = data.points;
                userData.points = points;
                updateUI();
                showSuccess('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­!');
            }
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        }
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    document.addEventListener('DOMContentLoaded', initApp);
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
    }
</script>
</body>
</html>